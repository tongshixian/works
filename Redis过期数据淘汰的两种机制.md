Redis的Cpu总是定时彪得很高，导致该瞬间的系统性能下降得厉害，过了这个高峰，又恢复正常，这是什么原因呢？

Redis里面的死神，过期Key的删除机制。

这是一个非常值得学习的一个系统架构解决方案，经常在面试题中出现。我们都知道Redis可以设置缓存内容的过期时间，也就是Redis里面，肯定存在一个机制，一到过期时间就把这些过期的数据删除掉

**惰性删除**

Redis很懒，有些Key直到被查询的时候，才会拿去判断是否已经超过了有效期，如果已经超过了有效期，那么才会被删除。也就是说，Redis里面，是有可能存在数据已经过期了的数据，那么如果这些key一直不被访问，岂不是会越来越多。Redis的设计者早就考虑到这个问题，并且添加了主动删除功能。

**主动删除**

主动删除功能就像一个死神，定时来把过期的数据清除掉。那么，这个死神是如何运作的呢？Redis每秒都会进行10次下面这样的操作：

- 1随机抽取20个设置了有效期的key
- 2把其中已经过期了的key删除掉
- 3如果过期的key超过25%，那么重新进行第一次操作

因为Redis是单线程的，为了避免资源都浪费在淘汰过期数据上，Redis限制了每次执行时间都是25毫秒，如果超过了这个时间，那么就直接退出。毕竟缓存的主要任务还是缓存数据，不能因小失大